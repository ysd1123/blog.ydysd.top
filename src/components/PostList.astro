---
import type { Language } from '@/i18n/config'
import type { Post } from '@/types'
import PinIcon from '@/assets/icons/pin-icon.svg'
import PostDate from '@/components/PostDate.astro'
import { getPostPath } from '@/i18n/path'
import { getPostDescription } from '@/utils/description'
import { isHomePage } from '@/utils/page'

export interface Props {
  posts: Post[]
  lang: Language
  pinned?: boolean
}

const { posts, lang, pinned = false } = Astro.props
const isHome = isHomePage(Astro.url.pathname)
---

<ul>
  {posts.map((post) => {
    const slug = post.data.abbrlink || post.id

    return (
      <li
        class:list={[
          'mb-5.5',
          isHome ? 'lg:mb-10' : '',
        ]}
      >
        {/* post title */}
        <h3 class="inline transition-colors hover:c-primary">
          <a
            class:list={[
              'cjk:tracking-wide',
              isHome ? 'lg:font-medium lg:text-4.5' : '',
            ]}
            href={getPostPath(slug, lang)}
            transition:name={`post-${slug}${lang ? `-${lang}` : ''}`}
            data-disable-theme-toggle-transition
          >
            {post.data.title}
          </a>
          {/* pinned icon */}
          {pinned && (
            <PinIcon
              aria-hidden="true"
              class="ml-0.25em inline-block aspect-square w-0.98em translate-y--0.1em lg:(w-1.05em translate-y--0.15em)"
              fill="currentColor"
            />
          )}
        </h3>

        {/* mobile post time */}
        <div
          class="py-0.8 text-3.5 font-time lg:hidden"
          transition:name={`time-${slug}${lang ? `-${lang}` : ''}`}
          data-disable-theme-toggle-transition
        >
          <PostDate
            date={post.data.published}
            minutes={post.remarkPluginFrontmatter.minutes}
          />
        </div>

        {/* desktop post time */}
        <div class="hidden text-3.65 font-time lg:(ml-2.5 inline)">
          <PostDate
            date={post.data.published}
            minutes={post.remarkPluginFrontmatter.minutes}
          />
        </div>

        {/* desktop post description */}
        {isHome && (
          <div
            class="heti hidden"
            lg="mt-2.25 block"
          >
            <p>{getPostDescription(post, 'list')}</p>
          </div>
        )}
      </li>
    )
  })}
</ul>
